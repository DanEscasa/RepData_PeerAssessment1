---
title: 'Reproducible Research: Activity Monitoring'
author: "Daniel Escasa"
output:
  pdf_document: default
  html_document:
    number_sections: yes
    keep_md: yes
editor_options:
  markdown:
    wrap: 72
---
```
{r setup, include=FALSE} knitr::opts_chunk$set(echo = TRUE)
```
# Introduction {.unnumbered}

*Excerpts from the [original
repo](https://github.com/rdpeng/RepData_PeerAssessment1) from which this
was forked*

It is now possible to collect a large amount of data about personal
movement using activity monitoring devices such as a
[Fitbit](http://www.fitbit.com), [Nike
Fuelband](http://www.nike.com/us/en_us/c/nikeplus-fuelband), or [Jawbone
Up](https://jawbone.com/up). These type of devices are part of the
"quantified self" movement -- a group of enthusiasts who take
measurements about themselves regularly to improve their health, to find
patterns in their behavior, or because they are tech geeks. But these
data remain under-utilized both because the raw data are hard to obtain
and there is a lack of statistical methods and software for processing
and interpreting the data.

This project makes use of data from a personal activity monitoring
device which collects data at five-minute intervals through out the day.

The data consists of two months of data from an anonymous individual
collected during the months of October and November, 2012 and include
the number of steps taken in five-minute intervals each day.

+---------------+-----------------------------------------------------+
| Variable name | Description                                         |
+===============+=====================================================+
| steps         | Number of steps taking in a five-minute interval    |
|               | (missing values are coded as `NA`)                |
+---------------+-----------------------------------------------------+
| date          | The date on which the measurement was taken, in     |
|               | YYYY-MM-DD format                                   |
+---------------+-----------------------------------------------------+
| interval      | Identifier for the five-minute interval in which    |
|               | measurement was taken                               |
+---------------+-----------------------------------------------------+

The following are the questions to be addressed:

-   What is mean total number of steps taken per day?

-   What is the average daily activity pattern?

-   Are there differences in activity patterns between weekdays and
    weekends?

# Boring admin stuff

## Install ggplot2, knitr, and scales if not yet installed

```{r echo = TRUE}
if (!require("ggplot2")) {
    message("Installing ggplot2")
    install.packages("ggplot2")
}
if (!require("knitr")) {
  message("Installing knitr")
  install.packages("knitr")
}
if (!require("scales")) {
  message("Installing scales")
  install.packages("scales")
}
```

## Download the zipped dataset if not yet present

```{r echo = TRUE}
if (!file.exists("activity.zip")) {
          message("Downloading dataset")
          download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", 
                        destfile = "activity.zip",  
                        method   = "internal", 
                        mode     = "wb")
     }
```

## Unzip the dataset if not yet present

```{r echo = TRUE}
if (!file.exists("activity.csv")) {
          message("Extracting dataset")
          unzip("activity.zip", 
                overwrite = FALSE)
     }
```

## Read in the data
```{r echo = TRUE}
# Shouldn't need error checking here
activity <- read.csv("activity.csv")
```
## Load the libraries
```{r}
library(ggplot2)
library(knitr)
library(scales)
```

# Now let's get cooking

## What is mean total number of steps taken per day?
Compute the total number, mean, and median steps per day.
As an aside, take note of the use of the superassignment (`<<-`) instead of the usual assignment operator (`<-`). This is because the `with(){}` creates its own scope. And yes, the scope applies to assigning to `colnames()`.
```{r echo = TRUE}
with(data = activity,{
     totalDaySteps  <<- aggregate(steps, by = list(date), FUN = sum)
     colnames(totalDaySteps) <<- c("date", "steps")
     meanDaySteps   <<- aggregate(steps, by = list(date), FUN = mean)
     colnames(meanDaySteps) <<- c("date", "steps")
     medianDaySteps <<- aggregate(steps, by = list(date), FUN = median)
     colnames(medianDaySteps) <<- c("date", "steps")
})
```
For convenience, merge the three into one dataframe.
```{r echo = TRUE}
dayStats           <- merge(totalDaySteps, meanDaySteps, by = "date")
dayStats           <- merge(dayStats, medianDaySteps, by = "date")
colnames(dayStats) <- c("date", "totalSteps", "meanSteps", "medianSteps")
```

Plot total number of steps taken each day, telling `barplot()` to remove spaces between bars. Also, using `(as.Date(date) - as.Date(totalDaySteps[1, 1]) + 1)` as `names.arg` so labels on x axis are day numbers, not the dates. This is so the plot is neater.
```{r echo = TRUE}
with(dayStats,
     barplot(space = 0, totalSteps,
             main  = "Total Number of Steps per Day",
             xlab  = "Day", ylab = "Total Steps", 
             names.arg = (as.Date(date) - as.Date(totalDaySteps[1, 1]) + 1)))
dev.copy(png, "plots/01-totalSteps.png")
dev.off()
```

Plot mean of number of steps per day.
```{r echo = TRUE}
with(dayStats, 
     barplot(space = 0, meanSteps, 
             main  = "Average Number of Steps per Day",
             xlab  = "Day", ylab = "Average Steps", 
             names.arg = (as.Date(date) - as.Date(totalDaySteps[1, 1]) + 1)))
dev.copy(png, "plots/02-meanSteps.png")
dev.off()
```


And here's the dataframe of average number of steps per day:
```{r}
kable(dayStats[, c(1, 3)],
      col.names = c("date", "mean"))
```

Lastly, plot the median number of steps per day.
```{r echo = TRUE}
with(dayStats, 
     barplot(space = 0, medianSteps, 
             main  = "Median Number of Steps per Day",
             xlab  = "Day", ylab = "Median Steps", 
             names.arg = (as.Date(date) - as.Date(totalDaySteps[1, 1]) + 1)))
dev.copy(png, "plots/03-medianSteps.png")
dev.off()
```

Median is zero because of the large number of zero steps. `NA`s may also account for that.

Since the median is zero for all days, there's no point in presenting the dataframe.

## What is the average daily activity pattern?
_Create a dataframe with steps per interval, and plot the line._

Define a function that will take an integer -- in this case, the interval -- and convert it to a `time` object.
```{r}
int2Time <- function(hhmm) {
     # separate the integer into its minute and hour components
     # assumes an integer of the form HHMM, where HH and MM are the hour
     # (between 0-23) and respectively.minute (between 0-59) components of the
     # time, 
     # Does not do parameter validation
     startHr  <- hhmm %% 100
     startMin <- hhmm %/% 100
     # and put them back together 
     return(paste0(substring(paste0("0", startMin), nchar(startMin)),
                   ":",
                   substring(paste0("0", startHr), nchar(startHr))))
}
```
Average the number of steps over each five-minute interval and plot the time series.
```{r}
intervalSteps <- aggregate(steps ~ interval, data = activity, mean)
intervalSteps$time <- as.POSIXct(int2Time(intervalSteps$interval), format = "%H:%M", tz = "MST")
ggplot(intervalSteps, aes(x = time, y = steps)) +
     geom_line() +
     scale_x_datetime(labels = date_format("%H:%M", tz = "MST"), 
                      date_breaks = "2 hours") +
     labs(title = "Time Series Plot of Average Steps Taken Per Day", 
          x = "Time of Day", y = "Average Steps") +
     theme(plot.title = element_text(hjust = 0.5))
dev.copy(png, "plots/04-intervalSteps.png")
dev.off()
```

So, from the plot, on average there is negligible activity from midnight (see below) to around 5:30 in the morning, slowly climbing at around 7:00, and a spike of over 200 steps at around 8:30.

From then on, there is a minimum of 25 to a maximum of 100 steps, and activity dies down starting close to 11:30 PM.

_Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?_

The starting time and corresponding average number of steps are in `intervalSteps[which.max(intervalSteps$steps), 1]` and `intervalSteps[which.max(intervalSteps$steps), 2]` respectively. I thought I'd include the end time of that interval by adding five minutes.
```{r echo = TRUE}
intervalStart <- intervalSteps[which.max(intervalSteps$steps), 1]
intervalEnd   <- intervalSteps[which.max(intervalSteps$steps), 1] + 5
averageSteps  <- intervalSteps[which.max(intervalSteps$steps), 2]
```
Since the steps from interval 0 to interval 600 are mostly zero, I'm betting that the measurements start midnight. If they don't, I'm screwed. Or not, maybe just have to make adjustments in the conversions.

What I'm fairly sure of is that the intervals are of the form `hhmm`, where hh and mm are the hour and minute components of the interval. As evidence, `interval` on the 24th row is 155, and on the 25th is 200. Examine the 36th and 37th rows, and `interval` goes from 255 to 300.

Output will be in 24-hour format.
```{r echo = TRUE}
sprintf("Maximum number of steps on average taken from %s to %s, number of steps = %f",
        int2Time(intervalStart), int2Time(intervalEnd), averageSteps)
```

## Imputing missing values

## Are there differences in activity patterns between weekdays and weekends?
